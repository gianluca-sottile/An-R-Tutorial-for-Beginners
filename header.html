<!-- header.html per R Markdown: fix tabset scroll + anchor offset -->

<script>
$(document).ready(function() {
  // Intercepta TUTTI i click sui tab R Markdown (tabs + pills)
  $(document).on('click', 
    '[data-toggle="tab"], [data-toggle="pill"], .nav-tabs a, .nav-pills a', 
    function (e) {
      // Salva posizione scroll
      var scrollmem = $(window).scrollTop();
      
      // Cambia tab SENZA movimento di scroll
      e.preventDefault();
      $(this).tab('show');
      
      // Ripristina posizione
      setTimeout(function() {
        $(window).scrollTop(scrollmem);
      }, 0);
    }
  );
});
</script>

<!-- Smooth scroll per anchor/TOC (opzionale, ma pulito) -->
<script>
(function (document, history, location) {
  var HISTORY_SUPPORT = !!(history && history.pushState);
  var OFFSET_HEIGHT_PX = 65;

  function scrollIfAnchor(href, pushToHistory) {
    if (!/^#[^ ]+$/.test(href)) return false;

    var match = document.getElementById(href.slice(1));
    if (match) {
      var anchorOffset = $(match).offset().top - OFFSET_HEIGHT_PX;
      $('html, body').animate({ scrollTop: anchorOffset });
      if (HISTORY_SUPPORT && pushToHistory) {
        history.pushState({}, document.title, location.pathname + href);
      }
    }
    return !!match;
  }

  $(window).on('hashchange', function() {
    scrollIfAnchor(window.location.hash);
  });
  $('body').on('click', 'a[href^="#"]', function (e) {
    scrollIfAnchor(this.getAttribute('href'), true);
  });
})(window.document, window.history, window.location);
</script>
