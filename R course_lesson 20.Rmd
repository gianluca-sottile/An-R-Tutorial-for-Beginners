---
title: "Bar Chart & Histogram in R (with Example)"
pagetitle: "Lesson 20"
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  fig.align = "center",
  message = FALSE,
  warning = FALSE
)
```

A bar chart is a great way to display a categorical variable on the x-axis. The y-axis can represent:

1. A **count** of observations in each group.
2. A **summary value** (e.g., mean, median, min/max) computed for each group.

In this lesson we use the `mtcars` dataset and focus on:

- `cyl`: number of cylinders (numeric, but used as a category)
- `am`: transmission (0 = automatic, 1 = manual)
- `mpg`: miles per gallon (numeric)

# How to create a bar chart

With **ggplot2**, the general pattern is:

```{r, eval=FALSE}
ggplot(data, aes(...)) + geom_*
```

In this tutorial we will mainly use:

- `geom_bar()` for counts (default behavior: `stat = "count"`) [web:592]
- `geom_col()` for precomputed values (equivalent to `geom_bar(stat = "identity")`) [web:592][web:585]

# Bar chart (counts)

## Basic count bar chart

```{r}
library(ggplot2)

ggplot(mtcars, aes(x = factor(cyl))) +
  geom_bar() +
  theme_classic() +
  labs(x = "Cylinders", y = "Count")
```

## Change the bar color

```{r}
ggplot(mtcars, aes(x = factor(cyl))) +
  geom_bar(fill = "coral") +
  theme_classic() +
  labs(x = "Cylinders", y = "Count")
```

## Change transparency (alpha)

```{r}
ggplot(mtcars, aes(x = factor(cyl))) +
  geom_bar(fill = "coral", alpha = 0.5) +
  theme_classic() +
  labs(x = "Cylinders", y = "Count")
```

## Color bars by group

```{r}
ggplot(mtcars, aes(x = factor(cyl), fill = factor(cyl))) +
  geom_bar() +
  theme_classic() +
  labs(x = "Cylinders", y = "Count", fill = "cyl")
```

# Grouped bar charts

A common use case is to show counts of a second categorical variable within each bar.

## Prepare the dataset

```{r}
library(dplyr)

cars <- mtcars |>
  mutate(
    cyl = factor(cyl),
    am = factor(am, labels = c("auto", "manual"))
  )
```

## Stacked bars (default)

```{r}
ggplot(cars, aes(x = cyl, fill = am)) +
  geom_bar() +
  theme_classic() +
  labs(x = "Cylinders", y = "Count", fill = "Transmission")
```

## Percent stacked bars

Use `position = "fill"` to show proportions instead of raw counts. [web:596]

```{r}
ggplot(cars, aes(x = cyl, fill = am)) +
  geom_bar(position = "fill") +
  theme_classic() +
  labs(x = "Cylinders", y = "Proportion", fill = "Transmission")
```

## Side-by-side bars

```{r}
ggplot(cars, aes(x = cyl, fill = am)) +
  geom_bar(position = position_dodge()) +
  theme_classic() +
  labs(x = "Cylinders", y = "Count", fill = "Transmission")
```

# Bar chart (values)

Sometimes you want bars to represent a numeric value (e.g., mean `mpg`) rather than counts. In this case, compute the summary first and then use `geom_col()`. [web:592]

## Step 1) Compute mean mpg by cylinders

```{r}
data_bar <- cars |>
  group_by(cyl) |>
  summarise(mean_mpg = mean(mpg), .groups = "drop") |>
  mutate(mean_mpg = round(mean_mpg, 2))

data_bar
```

## Step 2) Plot the bars

```{r}
ggplot(data_bar, aes(x = cyl, y = mean_mpg)) +
  geom_col() +
  theme_classic() +
  labs(x = "Cylinders", y = "Mean mpg")
```

## Step 3) Horizontal bars

```{r}
ggplot(data_bar, aes(x = cyl, y = mean_mpg)) +
  geom_col() +
  coord_flip() +
  theme_classic() +
  labs(x = "Cylinders", y = "Mean mpg")
```

## Step 4) Color by group + adjust width

```{r}
p <- ggplot(data_bar, aes(x = cyl, y = mean_mpg, fill = cyl)) +
  geom_col(width = 0.6) +
  coord_flip() +
  theme_classic() +
  guides(fill = "none") +
  labs(x = "Cylinders", y = "Mean mpg")

p
```

## Step 5) Add labels

```{r}
p +
  geom_text(aes(label = mean_mpg), hjust = -0.15, color = "grey20", size = 3.5) +
  expand_limits(y = max(data_bar$mean_mpg) * 1.10)
```

# Histogram

A histogram is used for **continuous** variables and shows the distribution of values by binning. For example, here is the distribution of `mpg`:

```{r}
ggplot(mtcars, aes(x = mpg)) +
  geom_histogram(bins = 12, fill = "#4AA4DE", color = "white") +
  theme_classic() +
  labs(x = "mpg", y = "Count")
```

# Summary

```{r, echo=FALSE}
library(knitr)

dt <- data.frame(
  Objective = c(
    "Count bars",
    "Count bars (grouped, stacked)",
    "Count bars (grouped, side-by-side)",
    "Percent stacked bars",
    "Bars representing values (precomputed y)"
  ),
  Example = c(
    "ggplot(df, aes(x)) + geom_bar()",
    "ggplot(df, aes(x, fill = g)) + geom_bar()",
    "ggplot(df, aes(x, fill = g)) + geom_bar(position = position_dodge())",
    "ggplot(df, aes(x, fill = g)) + geom_bar(position = 'fill')",
    "ggplot(df_sum, aes(x, y)) + geom_col()"
  )
)

knitr::kable(dt)
```
