---
title: "ANOVA: One-way & Two-way (with Examples)"
pagetitle: "Lesson 22"
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  fig.align = "center",
  message = FALSE,
  warning = FALSE
)
```

# What is ANOVA?

**Analysis of Variance (ANOVA)** is a statistical method used to test whether the means of two or more groups are equal. ANOVA is an extension of the two-sample t-test to settings with more than two groups.

ANOVA focuses on how the total variability in a numeric outcome can be decomposed into:
- Between-group variability (differences between group means),
- Within-group variability (variability of observations inside the same group).

# One-way ANOVA

A one-way ANOVA compares the means of a numeric variable across levels of a *single* categorical variable.

Example: a marketing department wants to know whether three teams have the same average sales performance.

## Hypotheses

- \(H_0\): All group means are equal.
- \(H_1\): At least one group mean differs.

## Assumptions (typical)

- Independent observations.
- Approximately normal residuals within each group.
- Equal variances across groups (homoscedasticity).

## Example: one-way ANOVA with the poisons dataset

We use the `poisons` dataset:

- `time`: survival time
- `poison`: poison type (3 levels)
- `treat`: treatment type (3 levels)

### Step 1) Import and prepare the data

```{r}
library(dplyr)
library(readr)

path <- "raw_data/poisons.csv"

df <- read_csv(path, show_col_types = FALSE) |>
  # robust: drop index column only if present
  select(-any_of(c("X", "x"))) |>
  mutate(
    poison = factor(poison),
    treat  = factor(treat)
  )

glimpse(df)
```

### Step 2) Summary statistics by group

```{r}
df |>
  group_by(poison) |>
  summarize(
    n = n(),
    mean_time = mean(time, na.rm = TRUE),
    sd_time = sd(time, na.rm = TRUE),
    .groups = "drop"
  )
```

### Step 3) Visual check (boxplot + jitter)

```{r}
library(ggplot2)

ggplot(df, aes(x = poison, y = time, fill = poison)) +
  geom_boxplot(alpha = 0.7, width = 0.65, outlier.shape = NA) +
  geom_jitter(width = 0.15, alpha = 0.6, size = 1.6, color = "steelblue") +
  theme_classic() +
  guides(fill = "none")
```

### Step 4) Fit the one-way ANOVA

```{r}
anova_one_way <- aov(time ~ poison, data = df)
summary(anova_one_way)
```

### Step 5) Post-hoc comparisons (Tukey HSD)

The ANOVA tells you whether *any* difference exists, but not *which* pairs differ. Tukeyâ€™s HSD provides pairwise comparisons with multiple-testing adjustment. [web:566]

```{r}
tukey_one_way <- TukeyHSD(anova_one_way)
tukey_one_way
```

```{r}
plot(tukey_one_way, las = 1)
```

# Two-way ANOVA

A two-way ANOVA includes **two** categorical predictors. You typically consider:
- Main effects: `poison` and `treat`
- Interaction: whether the effect of treatment depends on poison type

## Additive model (main effects only)

```{r}
anova_two_way_add <- aov(time ~ poison + treat, data = df)
summary(anova_two_way_add)
```

## Interaction model (recommended to check)

```{r}
anova_two_way_int <- aov(time ~ poison * treat, data = df)
summary(anova_two_way_int)
```

If the interaction term is significant, interpret the interaction first (effects are not constant across levels of the other factor).

# Summary

```{r, echo=FALSE}
library(knitr)

dt <- data.frame(
  Test = c("One-way ANOVA", "Post-hoc (pairwise)", "Two-way ANOVA (additive)", "Two-way ANOVA (interaction)"),
  Code = c(
    "aov(time ~ poison, data = df)",
    "TukeyHSD(anova_one_way)",
    "aov(time ~ poison + treat, data = df)",
    "aov(time ~ poison * treat, data = df)"
  )
)

knitr::kable(dt)
```
