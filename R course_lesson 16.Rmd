---
pagetitle: "Lesson 16"
title: "R: Exporting Data to Excel, CSV, SAS, STATA, Text File"
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  fig.align = "center",
  message = FALSE,
  warning = FALSE
)
```

Exporting data from R is mostly about choosing:
- a destination path (folder),
- a file name,
- and a file format (extension).

In this lesson you will export a small summary table to:
- CSV
- Excel (.xlsx)
- R data formats (.rds / .RData)
- SPSS / SAS / Stata (via **haven**) [web:672]

# Working directory

If you write a file using only its name (e.g., `"table_car.csv"`), R saves it in the current working directory.

```{r}
directory <- getwd()
directory
```

Tip: in projects (RStudio/Quarto), it is usually better to use project-relative paths (e.g., `data/` or `output/`) rather than relying on the current working directory.

# Create a data frame

We will start from `mtcars` and compute the mean of `mpg` and `disp` grouped by `gear`.

```{r}
library(dplyr)

df <- mtcars |>
  dplyr::select(mpg, disp, gear) |>
  dplyr::group_by(gear) |>
  dplyr::summarise(
    mean_mpg  = mean(mpg),
    mean_disp = mean(disp),
    .groups = "drop"
  )

df
```

Note: `dplyr::summarise()` is written explicitly to avoid function-name conflicts during rendering (common in sites/books with many packages loaded).

# Export to CSV

## write.csv()

```{r, eval=FALSE}
write.csv(df, "table_car.csv", row.names = FALSE)
```

- `row.names = FALSE` avoids writing the row numbers as an extra column (often unwanted).

## write.csv2() (semicolon-separated)

In some locales (common in Europe), Excel expects `;` as separator and `,` as decimal mark. You can use:

```{r, eval=FALSE}
write.csv2(df, "table_car.csv", row.names = FALSE)
```

# Export to Excel (.xlsx)

## Recommended (no Java): openxlsx

The historical `xlsx` package depends on Java and `rJava`, which can be painful on Mac/Linux/CI systems. [web:660]  
A smoother option is `openxlsx` (no Java), using `write.xlsx()`. [web:668]

```{r, eval=FALSE}
library(openxlsx)

write.xlsx(df, file = "table_car.xlsx", overwrite = TRUE)
```

You can also export multiple sheets by passing a named list. [web:668]

```{r, eval=FALSE}
write.xlsx(
  x = list("summary_by_gear" = df, "raw_mtcars" = mtcars),
  file = "mtcars_export.xlsx",
  overwrite = TRUE
)
```

## Alternative (simple): writexl

If you only need to write data frames quickly (less styling/features than openxlsx), `writexl` is a lightweight choice:

```{r, eval=FALSE}
writexl::write_xlsx(df, "table_car.xlsx")
```

# Export to other statistical software (haven)

The **haven** package reads/writes common formats from SPSS, SAS, and Stata. [web:672]

```{r}
library(haven)
```

## SPSS (.sav)

```{r, eval=FALSE}
haven::write_sav(df, "table_car.sav")
```

## SAS (.sas7bdat)

```{r, eval=FALSE}
haven::write_sas(df, "table_car.sas7bdat")
```

## Stata (.dta)

```{r, eval=FALSE}
haven::write_dta(df, "table_car.dta")
```

# Export R objects

## RDS (recommended for single objects)

```{r, eval=FALSE}
saveRDS(df, file = "table_car.rds")
# df2 <- readRDS("table_car.rds")
```

## RData (multiple objects)

```{r, eval=FALSE}
save(df, file = "table_car.RData")
# load("table_car.RData")
```

# Notes about “open folder”

Opening a folder from R (e.g., via `system()` / `shell.exec()`) may fail on servers and CI (GitHub Actions), so it’s safer to print the directory path and rely on the file browser of the environment.
```
